# Description: Secure Sockets Layer and Transport Layer Security tools
# URL:         http://www.openssl.org/
# Maintainer:  CRUX System Team, core-ports at crux dot nu

name=openssl-1
version=1.0.2l
release=2
source=(http://www.openssl.org/source/openssl-$version.tar.gz)

build() {
    cd openssl-$version
    export MAKEFLAGS="$MAKEFLAGS -j1"
    ./config --prefix=/usr/local --openssldir=/etc/ssl shared
    sed -i "s|-O3|$CFLAGS|" Makefile
    sed -i "s|SHLIB_VERSION_NUMBER\=.*|SHLIB_VERSION_NUMBER=1.0.2|" Makefile
    sed -i "s|SHLIB_MINOR\=.*|SHLIB_MINOR=0.2|" Makefile

    make depend
    make INSTALL_PREFIX=$PKG LIBDIR=lib MANDIR=/usr/man MANSUFFIX=ssl install

    chmod -R +w $PKG

    rm -rf $PKG/usr/local/{share,bin} $PKG/etc $PKG/usr/man
    ln -s libssl.so.1.0.2 $PKG/usr/local/lib/libssl.so.1.0.0
    ln -s libssl.so.1.0.2 $PKG/usr/local/lib/libssl.so.1.0.1
    ln -s libcrypto.so.1.0.2 $PKG/usr/local/lib/libcrypto.so.1.0.0
    ln -s libcrypto.so.1.0.2 $PKG/usr/local/lib/libcrypto.so.1.0.1
}
