#!/bin/sh

. `dirname $0`/common
. /etc/splash.functions

#set -x
#exec </dev/null >/var/log/splash.log  2>&1

case $1 in
start)
	while ! systemctl is-active systemd-udev \
	 && [ ! -e /dev/fb0 ]; do sleep .1 ; done

	splash_total=`systemctl list-units |grep -E '\.timer|\.target|\.service|\.slice|\.cups|\.device|\.mount|\.path|\.scope|\.socket' |wc -l`
#	if ! is_disabled $FASTBOOT; then
#		if [ "$FASTBOOT" == "lotsofmem" ]; then
#			let splash_total+=100
#		fi
#		if [ "$LM" == "3" ] || [ "$LM" == "5" ]; then
#			let splash_total+=100
#		fi
#	fi

	while ! systemctl is-active multi-user.target \
	 && [ ! -e /sys/devices/virtual/vtconsole/vtcon1 ]; do openvt -f -c 1 -- exit 0; sleep .1; done

	if ! systemctl is-active multi-user.target \
	&& [ -e /sys/devices/virtual/vtconsole/vtcon1 ]; then
		mkdir -p /lib/splash/cache
		splash
		splash_start
		while ! systemctl is-active multi-user.target; do
			progress=`systemctl list-units |grep -E '\.timer|\.target|\.service|\.slice|\.cups|\.device|\.mount|\.path|\.scope|\.socket' |grep -v inactive |wc -l`
			splash_progress
			sleep .1
		done
	fi
;;
stop)
	splash_exit
;;
esac
