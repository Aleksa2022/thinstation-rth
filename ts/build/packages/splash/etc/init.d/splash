#!/bin/sh

. `dirname $0`/common
. /etc/splash.functions

#set -x
#exec </dev/null >/var/log/splash.log  2>&1

case $1 in
start)
	while ! systemctl is-active systemd-udev \
	 && [ ! -e /sys/devices/virtual/vtconsole/vtcon1 ] \
	 && [ ! -e /dev/fb0 ]; do
		sleep .1
	done

	splash_total=`systemctl list-units |grep -E '\.timer|\.target|\.service|\.slice|\.cups|\.device|\.mount|\.path|\.scope|\.socket' |wc -l`
	if [ -e /sys/devices/virtual/vtconsole/vtcon1 ]; then
		while ! fbset > /dev/null 2>&1; do
			sleep .1
		done
		mkdir -p /lib/splash/cache
		splash
		splash_start
		while ! systemctl is-active multi-user.target; do
			progress=`systemctl list-units |grep -E '\.timer|\.target|\.service|\.slice|\.cups|\.device|\.mount|\.path|\.scope|\.socket' |grep -v inactive |wc -l`
			splash_progress
			sleep .1
		done
	fi
;;
stop)
	splash_exit
;;
esac
